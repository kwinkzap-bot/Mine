{% extends "base.html" %}
{% block title %}Options Chart Viewer{% endblock %}
{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ url_for('static', filename='css/options_chart.css') }}">
{% endblock %}
{% block content %}
<div class="form-container" id="options-chart-app">
    <div id="api-loader" class="api-loader hidden">
        <div class="spinner"></div>
        <p>Loading...</p>
    </div>
    <div class="form-row header-info" style="display: flex; justify-content: space-between; align-items: center;">
        <h2 style="margin: 0;">NIFTY Price: <span id="nifty-ltp" style="color: #00bcd4;">
            {% if nifty_val is defined and nifty_val is not none %}
                â‚¹{{ "{:.2f}".format(nifty_val) }}
            {% else %}
                N/A
            {% endif %}
        </span></h2>
        <div class="order-buttons-group" style="display: flex; gap: 10px;">
            <button id="buyPeBtn" type="button" class="btn order-btn order-btn-pe" title="Place buy order for PE strike">
                ðŸ”´ BUY PE
            </button>
            <button id="buyCeBtn" type="button" class="btn order-btn order-btn-ce" title="Place buy order for CE strike">
                ðŸŸ¢ BUY CE
            </button>
        </div>
    </div>
    <form id="optionsChartForm">
        <div class="form-row">

            <div class="form-group">
                <label for="ceStrike">CE Strike</label>
                <select id="ceStrike"></select>
            </div>
            <div class="form-group">
                <label for="peStrike">PE Strike</label>
                <select id="peStrike"></select>
            </div>
            <div class="form-group">
                <label>Price Source</label>
                <div class="radio-group">
                    <input type="radio" id="ltp" name="priceSource" value="ltp"> 
                    <label for="ltp">LTP</label>
                    <input type="radio" id="previous_close" name="priceSource" value="previous_close" checked>
                    <label for="previous_close">Previous Close</label>
                </div>
            </div>
            <div class="form-group">
                <button id="fetchChartBtn" type="submit" class="btn form-button">Fetch Chart Data</button>
            </div>
            <div class="timeframe-buttons" style="margin-left: auto;">
                <label>Timeframe:</label>
                <button type="button" class="timeframe-btn" data-timeframe="1minute">1m</button>
                <button type="button" class="timeframe-btn" data-timeframe="3minute">3m</button>
                <button type="button" class="timeframe-btn" data-timeframe="5minute">5m</button>
                <button type="button" class="timeframe-btn" data-timeframe="15minute">15m</button>
                <button type="button" class="timeframe-btn" data-timeframe="60minute">1h</button>
                <button type="button" class="timeframe-btn" data-timeframe="1day">1D</button>
            </div>
        </div>
    </form>
    <div class="charts-container">
        <div class="chart-grid">
            <div class="chart-wrapper">
                <h3>CE Chart <span id="ce-strike-display" class="strike-display"></span></h3>
                <div id="ceChart" class="chart-element"></div>
            </div>
            <div class="chart-wrapper">
                <h3>PE Chart <span id="pe-strike-display" class="strike-display"></span></h3>
                <div id="peChart" class="chart-element"></div>
            </div>
        </div>
        <div class="combined-chart-section">
            <h3>Combined CE & PE Price <span id="combined-ce-strike-display" class="strike-display"></span> <span id="combined-pe-strike-display" class="strike-display"></span></h3>
            <div id="combinedChart" class="chart-element"></div>
        </div>
    </div>
</div>
{% endblock %}
{% block scripts %}
<!-- Ensure constants.js is loaded first -->
<script src="{{ url_for('static', filename='js/constants.js') }}"></script>
{{ super() }}
<script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
<script src="{{ url_for('static', filename='js/options_chart_app.js') }}"></script>
{% endblock %}